;;; config/80_site-package.el --- installed package configurations

;; Copyright (C) 2012-2019 Zachary Elliott
;; See COPYING for more information

;; This file is not part of GNU Emacs.

;;; Commentary:

;;; Code:


;;; Company Mode Configs
(add-hook 'after-init-hook 'global-company-mode)
(eval-after-load 'company
  '(progn
     (setq
      company-frontends '(company-pseudo-tooltip-unless-just-one-frontend
                          company-preview-frontend
                          company-echo-metadata-frontend)
      company-tooltip-limit 10
      company-idle-delay 0.25
      company-minimum-prefix-length 2
      company-require-match 'never
      company-show-numbers t
      company-enable-lsp-snippet t)

     (define-key company-active-map (kbd "SPC")
       (lambda () (interactive) (company-complete-selection) (insert " ")))
     (define-key company-active-map (kbd "TAB") 'company-complete-common-or-cycle)
     (define-key company-active-map (kbd "<tab>") 'company-complete-common-or-cycle)
     (define-key company-active-map (kbd "S-TAB") 'company-select-previous)
     (define-key company-active-map (kbd "<backtab>") 'company-select-previous)

     (require 'company-terraform)
     (company-terraform-init)

     (add-to-list 'company-backends #'company-capf)
     ))


;;; Rainbow Delimiters Mode
(use-package rainbow-delimiters
  :hook (prog-mode . rainbow-delimiters-mode))


;;; Flyspell Mode
(setq
 ispell-program-name "aspell"
 ispell-extra-args '("--sug-mode=fast"))

(add-hook 'text-mode-hook (lambda () (flyspell-mode 1)))
(add-hook 'prog-mode-hook 'flyspell-prog-mode)


;;; Flycheck mode
(global-flycheck-mode)


;;; (rust-mode cargo racer company-racer flycheck-rust)
(with-eval-after-load 'rust-mode
  (add-hook 'flycheck-mode-hook 'flycheck-rust-setup)
  (add-hook 'rust-mode-hook 'racer-mode)
  (add-hook 'rust-mode-hook 'cargo-minor-mode))


;;; magit-mode
(global-set-key (kbd "C-c m s") 'magit-status)
(global-set-key (kbd "C-c m b") 'magit-blame)
(global-set-key (kbd "C-c m p") 'magit-process-mode)


;;; terraform-mode


;;; enhanced ruby mode
(add-to-list 'auto-mode-alist
             '("\\(?:\\.rb\\|ru\\|rake\\|thor\\|jbuilder\\|gemspec\\|podspec\\|/\\(?:Gem\\|Rake\\|Cap\\|Thor\\|Vagrant\\|Guard\\|Pod\\)file\\)\\'" . enh-ruby-mode))


;;; lsp-mode

(dolist (mode-hook '(c-mode-common-hook
                     lua-mode-hook
                     python-mode-hook
                     enh-ruby-mode-hook
                     rust-mode-hook))
  (add-hook mode-hook #'lsp-deferred))

(with-eval-after-load 'lsp-mode
  (require 'lsp-ui)

  (setq
   lsp-message-project-root-warning t
   lsp-auto-configure t
   lsp-enable-snippet t

   lsp-ui-doc-enable t
   lsp-ui-flycheck-enable t
   lsp-ui-imenu-enable nil
   lsp-ui-peek-enable t


   ;; lsp-ui-flycheck-enable t
   ;; lsp-ui-sideline-enable t
   )

  (add-hook 'lsp-mode-hook 'lsp-ui-mode)
  (add-hook 'lsp-mode-hook 'yas-minor-mode)

  (define-key lsp-ui-mode-map [remap xref-find-definitions] 'lsp-ui-peek-find-definitions)
  (define-key lsp-ui-mode-map [remap xref-find-references] 'lsp-ui-peek-find-references)

  (require 'company-lsp)
  (push '(company-lsp :with company-yasnippet) company-backends))


;;; dockerfile-mode
(put 'docker-image-name 'safe-local-variable #'stringp)
(put 'dockerfile-image-name 'safe-local-variable #'stringp)


;;; config/80_site-package.el ends here
